---
layout:     post
title:      Linux I/O
toc:        true
categories: [System Programming, C/C++]
---
# (一) POSIX I/O
**POSIX I/O**是POSIX标准的组成部分，而非C标准的组成部分。**作为Linux最底层的I/O处理函数，POSIX I/O仅仅将文件看作是一个个字节，无任何其他格式而言。**不难推断，包括C Standard I/O在内的其他I/O库在Linux上的实现均是对POSIX I/O的封装。

## 1. POSIX I/O Basics

### 1.1 Linux文件

#### 1.1.1 文件描述符
对于Linux内核而言，所有打开的文件都通过**File Descriptor(文件名描述符)**引用。File Descriptor是一个非负整数，当打开一个现有文件或创建一个新文件时，Linux内核就会返回一个File Descriptor；当读写一个文件时，就需要将其File Descriptor作为参数传递给read或write。

#### 1.1.2 文件偏移
每个打开的文件都有一个与之相关联的**文件偏移**，通常读写操作都是从当前文件偏移开始，并使偏移增加所读写的字节数。


### 1.2 打开、创建和关闭一个文件
打开和创建文件：
```c
#include <fcntl.h>  // short file control

int open(const char* path, int flags);
int open(const char* path, int flags, mode_t mode);

int creat(const char* path, mode_t mode);
// equals to open(path, O_WRONLY | O_CREAT | O_TRUNC, mode)

int openat(int fd, const char* path, int flags);
int openat(int fd, const char* path, int flags, mode_t mode);
```
关闭文件：
```c
#include <unistd.h>

int close(int fd);
```

### 1.3 设置文件偏移
```c
#include <unistd.h>

off_t lseek(int fd, off_t offset, int whence);
```
对offset的解释与参数whence的值有关：
* whence == SEEK_SET：文件起始 + offset；
* whence == SEEK_CUR：当前偏移量 + offset；
* whence == SEEK_END：文件长度 + offset；

### 1.4 read()
```c
#include <unistd.h>

ssize_t read(int fd, void *buf, size_t nbytes);
```

### 1.5 write()
```c
#include <unistd.h>

ssize_t write(int fd, const void* buf, size_t nbytes);
```

## 2. I/O Cache与延迟写

## 3. 高性能I/O